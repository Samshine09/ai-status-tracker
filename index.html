<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Provider Status Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
     :root {
      --bg: #0a0a0f;
      --surface: #12121a;
      --border: #1e1e2e;
      --text: #e8e8f0;
      --muted: #5a5a7a;
      --green: #00ff9d;
      --yellow: #ffd700;
      --red: #ff4d6d;
      --blue: #4d9fff;
      --accent: #7c6af7;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Syne', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
      opacity: 0.4;
    }

    .wrapper { position: relative; z-index: 1; max-width: 960px; margin: 0 auto; padding: 48px 24px 80px; }

    header { margin-bottom: 48px; }
    .header-top { display: flex; align-items: flex-start; justify-content: space-between; flex-wrap: wrap; gap: 16px; }

    h1 { font-size: clamp(2rem, 5vw, 3.2rem); font-weight: 800; letter-spacing: -0.03em; line-height: 1; color: #fff; }
    h1 span { color: var(--accent); }

    .subtitle { font-family: 'Space Mono', monospace; font-size: 0.75rem; color: var(--muted); margin-top: 10px; letter-spacing: 0.05em; }

    .refresh-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 20px;
      border-radius: 8px;
      font-family: 'Space Mono', monospace;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
      letter-spacing: 0.05em;
    }
    .refresh-btn:hover { border-color: var(--accent); color: var(--accent); }
    .refresh-btn.spinning svg { animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .last-updated { font-family: 'Space Mono', monospace; font-size: 0.7rem; color: var(--muted); margin-top: 4px; text-align: right; }

    .providers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(440px, 1fr)); gap: 20px; margin-bottom: 48px; }

    .provider-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      position: relative;
      overflow: hidden;
      transition: border-color 0.3s;
    }
    .provider-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: var(--status-color, var(--muted)); transition: background 0.5s; }

    .provider-card.operational { --status-color: var(--green); }
    .provider-card.degraded { --status-color: var(--yellow); }
    .provider-card.outage { --status-color: var(--red); }
    .provider-card.loading { --status-color: var(--muted); }

    .provider-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .provider-name { font-size: 1.1rem; font-weight: 800; letter-spacing: -0.02em; }
    .provider-url { font-family: 'Space Mono', monospace; font-size: 0.65rem; color: var(--muted); margin-top: 2px; }

    .status-badge { display: flex; align-items: center; gap: 6px; font-family: 'Space Mono', monospace; font-size: 0.7rem; padding: 4px 10px; border-radius: 100px; border: 1px solid currentColor; }
    .status-badge.operational { color: var(--green); }
    .status-badge.degraded { color: var(--yellow); }
    .status-badge.outage { color: var(--red); }
    .status-badge.loading { color: var(--muted); }

    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }
    .status-dot.pulse { animation: pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.8); } }

    .uptime-section { margin-top: 14px; }
    .uptime-label { display: flex; justify-content: space-between; font-family: 'Space Mono', monospace; font-size: 0.65rem; color: var(--muted); margin-bottom: 6px; }
    .uptime-bar { display: flex; gap: 2px; height: 24px; }
    .uptime-segment.ok { background: var(--green); }
    .uptime-segment.warn { background: var(--yellow); }
    .uptime-segment.down { background: var(--red); }

    .uptime-bar-container { display: flex; flex-direction: column; gap: 4px; }
    .uptime-dates { display: flex; gap: 2px; }
    .uptime-date { flex: 1; font-family: 'Space Mono', monospace; font-size: 0.55rem; text-align: center; color: var(--muted); }

    .incidents-section { margin-top: 16px; border-top: 1px solid var(--border); padding-top: 16px; }
    .incidents-title { font-family: 'Space Mono', monospace; font-size: 0.65rem; color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 10px; }
    .incident-item { display: flex; align-items: flex-start; gap: 10px; padding: 8px 0; border-bottom: 1px solid var(--border); }
    .incident-item:last-child { border-bottom: none; }
    .incident-dot { width: 8px; height: 8px; border-radius: 50%; margin-top: 4px; flex-shrink: 0; }
    .incident-dot.investigating { background: var(--yellow); }
    .incident-dot.identified { background: var(--yellow); }
    .incident-dot.monitoring { background: var(--blue); }
    .incident-dot.resolved { background: var(--green); }
    .incident-dot.postmortem { background: var(--muted); }
    .incident-name { font-size: 0.8rem; font-weight: 600; line-height: 1.3; }
    .incident-meta { font-family: 'Space Mono', monospace; font-size: 0.65rem; color: var(--muted); margin-top: 2px; }
    .no-incidents { font-family: 'Space Mono', monospace; font-size: 0.7rem; color: var(--muted); font-style: italic; }

    /* --- NEW SINGLE-LINE INCIDENT TRACKER --- */
    .provider-card .incident-tracker-line {
      height: 4px;
      width: 100%;
      display: flex;
      gap: 1px;
      margin-top: 8px;
    }
    .provider-card .incident-tracker-line div {
      flex: 1;
      background: var(--muted);
    }
    .provider-card .incident-tracker-line div.ok { background: var(--green); }
    .provider-card .incident-tracker-line div.warn { background: var(--yellow); }
    .provider-card .incident-tracker-line div.down { background: var(--red); }

    /* chart, legend, etc omitted for brevity; keep your existing styles */
  </style>
</head>
<body>
<div class="wrapper">

  <header>
    <div class="header-top">
      <div>
        <h1>AI Provider<br><span>Status</span> Tracker</h1>
        <p class="subtitle">// LIVE DATA FROM OFFICIAL STATUS PAGES</p>
      </div>
      <div>
        <button class="refresh-btn" id="refreshBtn" onclick="fetchAll()">
          <svg id="refreshIcon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="display:inline;vertical-align:middle;margin-right:6px">
            <polyline points="23 4 23 10 17 10"></polyline>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
          </svg>REFRESH
        </button>
        <div class="last-updated" id="lastUpdated">‚Äî</div>
      </div>
    </div>
  </header>

  <div class="providers-grid" id="providersGrid">
    <!-- Cards injected by JS -->
  </div>

  <div class="chart-section">
    <div class="chart-title">Incident Count ‚Äî Last 90 Days</div>
    <div class="chart-subtitle">// INCIDENTS PER PROVIDER, SCRAPED FROM PUBLIC STATUS PAGES</div>
    <canvas id="incidentChart" height="180"></canvas>
    <div class="legend" id="chartLegend"></div>
  </div>

  <div class="note-box">
    <strong>How this works:</strong> Each provider (Anthropic, OpenAI, Google Gemini, xAI Grok) uses Atlassian Statuspage,
    which exposes a public <code>/api/v2/summary.json</code> and <code>/api/v2/incidents.json</code> endpoint.
    This dashboard fetches those directly in your browser. No API keys needed.
    <br/><br/>
    <strong>Note:</strong> Official status pages tend to underreport degraded performance ‚Äî they typically only show
    confirmed incidents, not elevated error rates. That's what makes your theory worth testing! üîç
  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script>
const PROVIDERS = [
  { id: 'anthropic', name: 'Anthropic', color: '#cc785c', statusUrl: 'https://status.anthropic.com/api/v2/summary.json', incidentsUrl: 'https://status.anthropic.com/api/v2/incidents.json', pageUrl: 'status.anthropic.com' },
  { id: 'openai', name: 'OpenAI / ChatGPT', color: '#10a37f', statusUrl: 'https://status.openai.com/api/v2/summary.json', incidentsUrl: 'https://status.openai.com/api/v2/incidents.json', pageUrl: 'status.openai.com' },
  { id: 'google', name: 'Google Gemini', color: '#4285f4', statusUrl: 'https://status.cloud.google.com/incidents.json', incidentsUrl: null, pageUrl: 'aistudio.google.com/status', isGoogle: true },
  { id: 'xai', name: 'xAI / Grok', color: '#ffffff', statusUrl: 'https://status.x.ai/api/v2/summary.json', incidentsUrl: 'https://status.x.ai/api/v2/incidents.json', pageUrl: 'status.x.ai' },
];

let providerData = {};
let chartInstance = null;

function statusClass(indicator) {
  if (!indicator) return 'loading';
  if (indicator === 'none') return 'operational';
  if (indicator === 'minor' || indicator === 'major') return 'degraded';
  if (indicator === 'critical') return 'outage';
  return 'operational';
}
function statusLabel(indicator) {
  if (!indicator) return 'Loading...';
  if (indicator === 'none') return 'Operational';
  if (indicator === 'minor') return 'Minor Issues';
  if (indicator === 'major') return 'Major Outage';
  if (indicator === 'critical') return 'Critical';
  return 'Operational';
}
function incidentStatusClass(status) { return status?.toLowerCase().replace(/ /g, '_') || 'monitoring'; }
function timeAgo(dateStr) { const diff = Date.now() - new Date(dateStr); const mins = Math.floor(diff / 60000); const hours = Math.floor(mins / 60); const days = Math.floor(hours / 24); if (days > 0) return `${days}d ago`; if (hours > 0) return `${hours}h ago`; return `${mins}m ago`; }

function buildUptimeBar(incidents) {
  const days = 90;
  const now = new Date();
  const segments = Array(days).fill('ok');
  if (incidents) {
    incidents.forEach(inc => {
      const start = new Date(inc.created_at).getTime();
      const dayIdx = Math.floor((now - start) / (1000 * 60 * 60 * 24));
      if (dayIdx >= 0 && dayIdx < days) {
        const impact = inc.impact;
        if (impact === 'critical') segments[days - 1 - dayIdx] = 'down';
        else if (impact === 'major' || impact === 'minor') segments[days - 1 - dayIdx] = 'warn';
      }
    });
  }
  const bars = segments.map(s => `<div class="uptime-segment ${s}"></div>`).join('');
  const dates = segments.map((_, i) => {
    if (i % 7 === 0 || i === days - 1) {
      const date = new Date();
      date.setDate(now.getDate() - (days - 1 - i));
      return `<div class="uptime-date">${date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' })}</div>`;
    } else return `<div class="uptime-date">&nbsp;</div>`;
  }).join('');
  return `<div class="uptime-bar-container"><div class="uptime-bar">${bars}</div><div class="uptime-dates">${dates}</div></div>`;
}

function renderCard(p, data, error) {
  const indicator = data?.status?.indicator;
  const cls = error ? 'degraded' : statusClass(indicator);
  const label = error ? 'Fetch Error' : statusLabel(indicator);
  const isPulse = cls === 'operational';
  const recentIncidents = (data?.incidents || []).slice(0, 3);
  const allIncidents = data?.allIncidents || [];

  // --- SINGLE-LINE INCIDENT TRACKER ---
  const trackerLine = (allIncidents || []).slice(-10).map(inc => {
    let cls = 'ok';
    if (inc.impact === 'critical') cls = 'down';
    else if (inc.impact === 'major' || inc.impact === 'minor') cls = 'warn';
    return `<div class="${cls}"></div>`;
  }).join('');

  return `
    <div class="provider-card ${cls}" id="card-${p.id}">
      <div class="provider-header">
        <div>
          <div class="provider-name">${p.name}</div>
          <div class="provider-url">${p.pageUrl}</div>
        </div>
        <div class="status-badge ${cls}">
          <div class="status-dot ${isPulse ? 'pulse' : ''}"></div>
          ${label}
        </div>
      </div>

      ${trackerLine ? `<div class="incident-tracker-line">${trackerLine}</div>` : ''}

      <div class="uptime-section">
        <div class="uptime-label">
          <span>90-day incident map</span>
          <span>${allIncidents.length} incidents</span>
        </div>
        <div class="uptime-bar">${buildUptimeBar(allIncidents)}</div>
      </div>

      <div class="incidents-section">
        <div class="incidents-title">Recent Incidents</div>
        ${error ? `<div class="fetch-error">‚ö† ${error}</div>` : ''}
        ${recentIncidents.length === 0 && !error
          ? `<div class="no-incidents">No active incidents reported</div>`
          : recentIncidents.map(inc => `
            <div class="incident-item">
              <div class="incident-dot ${incidentStatusClass(inc.status)}"></div>
              <div>
                <div class="incident-name">${inc.name}</div>
                <div class="incident-meta">${inc.status} ¬∑ ${timeAgo(inc.updated_at || inc.created_at)}</div>
              </div>
            </div>
          `).join('')
        }
      </div>
    </div>
  `;
}

// --- rest of your JS (skeletons, fetchAll, chart) remains unchanged ---
// copy exactly your previous JS for fetchProvider, fetchAll, buildChart, etc.
</script>
</body>
</html>
